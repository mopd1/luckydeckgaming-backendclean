import{_ as Ve,r as c,o as ye,i as W,l as he,a as J,b as s,c as U,d as K,h as g,e,w as t,f as r,t as b,g as ie,p as Q,q as Se,s as Ce,u as Ue,j as te,m as oe,F as De,k as Me,v as ke}from"./index-968909ce.js";const $e=$=>(Se("data-v-9259c827"),$=$(),Ce(),$),Ie={class:"d-flex justify-space-between align-center mb-4"},Te=$e(()=>g("h2",{class:"text-h5"},"Season List",-1)),Ae={class:"text-h5"},Pe={__name:"SeasonsTab",setup($){const x=c([]),y=c(!0),m=c(!1),h=c(!1),V=c(!1),p=c(!1),f=c(""),S=c(()=>{}),I=c(!1),k=c(null),C=c(!1),T=c(null),D=c(null),H=c(null),ne=c(null),w={season_id:null,name:"",description:"",start_date:new Date,end_date:new Date(new Date().setMonth(new Date().getMonth()+1)),is_active:!1},o=c({...w}),A=[{title:"Season ID",key:"season_id",sortable:!0,width:"10%"},{title:"Name",key:"name",sortable:!0,width:"25%"},{title:"Start Date",key:"start_date",sortable:!0,width:"15%"},{title:"End Date",key:"end_date",sortable:!0,width:"15%"},{title:"Status",key:"is_active",sortable:!0,width:"10%"},{title:"Actions",key:"actions",sortable:!1,width:"25%",align:"end"}];ye(async()=>{await N()});const X=W(()=>O(o.value.start_date)),de=W(()=>O(o.value.end_date));he(()=>o.value.start_date,(i,n)=>{(i==null?void 0:i.getTime())!==(n==null?void 0:n.getTime())&&Q(()=>{var v;(v=k.value)==null||v.validate()})}),he(()=>o.value.end_date,(i,n)=>{(i==null?void 0:i.getTime())!==(n==null?void 0:n.getTime())&&Q(()=>{var v;(v=k.value)==null||v.validate()})});async function N(){y.value=!0;try{const i=await J.get("/admin/season-pass/seasons");x.value=i.data.map(n=>({...n,start_date:n.start_date?new Date(n.start_date):null,end_date:n.end_date?new Date(n.end_date):null}))}catch(i){console.error("Error fetching seasons:",i),alert("Failed to load seasons data")}finally{y.value=!1}}function ue(){console.log("Opening create dialog..."),C.value=!1,o.value={season_id:null,name:"",description:"",start_date:new Date,end_date:new Date(new Date().setMonth(new Date().getMonth()+1)),is_active:!1},Q(()=>{var i;(i=k.value)==null||i.resetValidation(),I.value=!1}),m.value=!0}function ce(i){console.log("Opening edit dialog for season:",i.season_id),C.value=!0,o.value={...i,start_date:i.start_date instanceof Date?i.start_date:i.start_date?new Date(i.start_date):null,end_date:i.end_date instanceof Date?i.end_date:i.end_date?new Date(i.end_date):null},Q(()=>{var n;(n=k.value)==null||n.resetValidation(),I.value=!1}),m.value=!0}function se(){m.value=!1}function _e(){console.log("Opening start date picker. Current start date:",o.value.start_date),H.value=o.value.start_date?new Date(o.value.start_date.getTime()):null,T.value=o.value.start_date?new Date(o.value.start_date.getTime()):new Date,h.value=!0}function me(){console.log("Opening end date picker. Current end date:",o.value.end_date),ne.value=o.value.end_date?new Date(o.value.end_date.getTime()):null,D.value=o.value.end_date?new Date(o.value.end_date.getTime()):new Date,V.value=!0}function ve(){o.value.start_date=T.value,console.log("Confirmed start date, setting editedSeason.start_date to:",o.value.start_date),h.value=!1,Q(()=>{var i;return(i=k.value)==null?void 0:i.validate()})}function pe(){console.log("Cancelled start date picker."),h.value=!1}function fe(){o.value.end_date=D.value,console.log("Confirmed end date, setting editedSeason.end_date to:",o.value.end_date),V.value=!1,Q(()=>{var i;return(i=k.value)==null?void 0:i.validate()})}function d(){console.log("Cancelled end date picker."),V.value=!1}async function l(){var z,q,B,F;const{valid:i}=await k.value.validate();if(!i){console.warn("Form validation failed.");return}y.value=!0;const n=_=>{if(_ instanceof Date&&!isNaN(_)){const L=_.getFullYear(),R=(_.getMonth()+1).toString().padStart(2,"0"),Y=_.getDate().toString().padStart(2,"0");return`${L}-${R}-${Y}`}return null},v={name:o.value.name,description:o.value.description,start_date:n(o.value.start_date),end_date:n(o.value.end_date),is_active:o.value.is_active};console.log("Attempting to save season. Payload being sent:",JSON.stringify(v,null,2));try{C.value&&o.value.season_id?(console.log(`Sending PUT request to /admin/season-pass/seasons/${o.value.season_id}`),await J.put(`/admin/season-pass/seasons/${o.value.season_id}`,v)):(console.log("Sending POST request to /admin/season-pass/seasons"),await J.post("/admin/season-pass/seasons",v)),await N(),se()}catch(_){console.error("Error saving season:",_),_.response&&console.error("Backend Response Error Data:",_.response.data);const L=((q=(z=_.response)==null?void 0:z.data)==null?void 0:q.error)||((F=(B=_.response)==null?void 0:B.data)==null?void 0:F.message)||_.message||"Failed to save season";alert(`Error: ${L}`)}finally{y.value=!1}}function E(i){const n=x.value.find(v=>v.season_id===i.season_id);n&&(f.value=n.is_active?`Are you sure you want to deactivate the "${n.name}" season? This cannot be undone easily.`:`Are you sure you want to activate the "${n.name}" season? Any other active season will be deactivated.`,S.value=async()=>{var v,z;p.value=!1,y.value=!0;try{await J.put(`/admin/season-pass/seasons/${n.season_id}/toggle-active`),await N()}catch(q){console.error("Error toggling season status:",q),q.response&&console.error("Backend Response Error Data:",q.response.data),alert("Failed to update season status. "+(((z=(v=q.response)==null?void 0:v.data)==null?void 0:z.message)||"")),await N()}finally{y.value=!1}},p.value=!0)}function Z(){typeof S.value=="function"&&S.value()}function P(i){localStorage.setItem("selectedSeasonId",i.season_id);const n=new CustomEvent("change-tab",{detail:"milestones"});window.dispatchEvent(n)}function O(i){if(!i)return"";const n=i instanceof Date?i:new Date(i);return isNaN(n.getTime())?"":n.toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"2-digit"})}return(i,n)=>{const v=s("v-btn"),z=s("v-chip"),q=s("v-icon"),B=s("v-tooltip"),F=s("v-data-table"),_=s("v-card"),L=s("v-card-title"),R=s("v-text-field"),Y=s("v-textarea"),re=s("v-col"),ae=s("v-row"),le=s("v-switch"),ge=s("v-form"),ee=s("v-spacer"),j=s("v-date-picker"),a=s("v-dialog"),G=s("v-card-text"),M=s("v-card-actions");return U(),K("div",null,[g("div",Ie,[Te,e(v,{color:"primary","prepend-icon":"mdi-plus",onClick:ue},{default:t(()=>[r(" Create Season ")]),_:1})]),e(_,null,{default:t(()=>[e(F,{headers:A,items:x.value,loading:y.value,class:"elevation-1"},{"item.start_date":t(({item:u})=>[r(b(O(u.start_date)),1)]),"item.end_date":t(({item:u})=>[r(b(O(u.end_date)),1)]),"item.is_active":t(({item:u})=>[e(z,{color:u.is_active?"success":"error","text-color":"white",size:"small"},{default:t(()=>[r(b(u.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),"item.actions":t(({item:u})=>[e(v,{icon:"",variant:"text",color:"primary",size:"small",onClick:be=>ce(u)},{default:t(()=>[e(q,null,{default:t(()=>[r("mdi-pencil")]),_:1})]),_:2},1032,["onClick"]),e(v,{icon:"",variant:"text",color:"primary",size:"small",onClick:be=>P(u)},{default:t(()=>[e(q,null,{default:t(()=>[r("mdi-chart-timeline-variant")]),_:1}),e(B,{activator:"parent",location:"top"},{default:t(()=>[r("View Milestones")]),_:1})]),_:2},1032,["onClick"]),e(v,{icon:"",variant:"text",color:u.is_active?"error":"success",size:"small",onClick:be=>E(u)},{default:t(()=>[e(q,null,{default:t(()=>[r(b(u.is_active?"mdi-close":"mdi-check"),1)]),_:2},1024),e(B,{activator:"parent",location:"top"},{default:t(()=>[r(b(u.is_active?"Deactivate":"Activate"),1)]),_:2},1024)]),_:2},1032,["color","onClick"])]),_:1},8,["items","loading"])]),_:1}),e(a,{modelValue:m.value,"onUpdate:modelValue":n[8]||(n[8]=u=>m.value=u),"max-width":"600px",persistent:""},{default:t(()=>[e(_,null,{default:t(()=>[e(L,null,{default:t(()=>[g("span",Ae,b(C.value?"Edit Season":"Create New Season"),1)]),_:1}),e(G,null,{default:t(()=>[e(ge,{ref_key:"form",ref:k,modelValue:I.value,"onUpdate:modelValue":n[3]||(n[3]=u=>I.value=u)},{default:t(()=>[e(R,{modelValue:o.value.name,"onUpdate:modelValue":n[0]||(n[0]=u=>o.value.name=u),label:"Season Name",required:"",rules:[u=>!!u||"Name is required"],variant:"outlined",density:"compact"},null,8,["modelValue","rules"]),e(Y,{modelValue:o.value.description,"onUpdate:modelValue":n[1]||(n[1]=u=>o.value.description=u),label:"Description",rows:"3",variant:"outlined",density:"compact"},null,8,["modelValue"]),e(ae,null,{default:t(()=>[e(re,{cols:"12",sm:"6"},{default:t(()=>[e(R,{value:X.value,label:"Start Date","prepend-icon":"mdi-calendar",readonly:"",onClick:_e,rules:[u=>!!o.value.start_date||"Start date is required"],variant:"outlined",density:"compact"},null,8,["value","rules"])]),_:1}),e(re,{cols:"12",sm:"6"},{default:t(()=>[e(R,{value:de.value,label:"End Date","prepend-icon":"mdi-calendar",readonly:"",onClick:me,rules:[u=>!!o.value.end_date||"End date is required",u=>!o.value.start_date||!o.value.end_date||new Date(o.value.end_date)>=new Date(o.value.start_date)||"End date must be after start date"],variant:"outlined",density:"compact"},null,8,["value","rules"])]),_:1})]),_:1}),e(le,{modelValue:o.value.is_active,"onUpdate:modelValue":n[2]||(n[2]=u=>o.value.is_active=u),color:"primary",label:"Active Season",hint:"Only one season can be active at a time","persistent-hint":"",density:"compact",inset:""},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(a,{ref:"startDateDialogRef",modelValue:h.value,"onUpdate:modelValue":n[5]||(n[5]=u=>h.value=u),width:"auto"},{default:t(()=>[e(j,{modelValue:T.value,"onUpdate:modelValue":n[4]||(n[4]=u=>T.value=u),"show-adjacent-months":"","hide-header":""},{actions:t(()=>[e(ee),e(v,{text:"",color:"grey",onClick:ie(pe,["stop"])},{default:t(()=>[r("Cancel")]),_:1}),e(v,{text:"",color:"primary",onClick:ie(ve,["stop"])},{default:t(()=>[r("OK")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),e(a,{ref:"endDateDialogRef",modelValue:V.value,"onUpdate:modelValue":n[7]||(n[7]=u=>V.value=u),width:"auto"},{default:t(()=>[e(j,{modelValue:D.value,"onUpdate:modelValue":n[6]||(n[6]=u=>D.value=u),min:o.value.start_date?o.value.start_date.toISOString().split("T")[0]:void 0,"show-adjacent-months":"","hide-header":""},{actions:t(()=>[e(ee),e(v,{text:"",color:"grey",onClick:ie(d,["stop"])},{default:t(()=>[r("Cancel")]),_:1}),e(v,{text:"",color:"primary",onClick:ie(fe,["stop"])},{default:t(()=>[r("OK")]),_:1})]),_:1},8,["modelValue","min"])]),_:1},8,["modelValue"])]),_:1}),e(M,null,{default:t(()=>[e(ee),e(v,{color:"grey-darken-1",variant:"text",onClick:se},{default:t(()=>[r("Cancel")]),_:1}),e(v,{color:"blue-darken-1",variant:"elevated",onClick:l,disabled:!I.value},{default:t(()=>[r("Save")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(a,{modelValue:p.value,"onUpdate:modelValue":n[10]||(n[10]=u=>p.value=u),"max-width":"400px"},{default:t(()=>[e(_,null,{default:t(()=>[e(L,{class:"text-h5"},{default:t(()=>[r("Confirm")]),_:1}),e(G,null,{default:t(()=>[r(b(f.value),1)]),_:1}),e(M,null,{default:t(()=>[e(ee),e(v,{color:"grey-darken-1",variant:"text",onClick:n[9]||(n[9]=u=>p.value=!1)},{default:t(()=>[r("Cancel")]),_:1}),e(v,{color:"red-darken-1",variant:"text",onClick:Z},{default:t(()=>[r("Confirm")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},qe=Ve(Pe,[["__scopeId","data-v-9259c827"]]),Ee={class:"d-flex align-center"},xe={__name:"RewardDisplay",props:{type:{type:String,required:!0},amount:{type:[Number,String],required:!0}},setup($){const x=$,y=W(()=>Number(x.amount).toLocaleString()),m=W(()=>{switch(x.type){case"chips":return"Chips";case"gems":return"Gems";case"avatar_part":return"Avatar Part";case"pack":return"Pack";default:return x.type}}),h=W(()=>{switch(x.type){case"chips":return"mdi-poker-chip";case"gems":return"mdi-diamond-stone";case"avatar_part":return"mdi-face-man";case"pack":return"mdi-package-variant-closed";default:return"mdi-gift"}}),V=W(()=>{switch(x.type){case"chips":return"blue";case"gems":return"purple";case"avatar_part":return"green";case"pack":return"amber";default:return"grey"}});return(p,f)=>{const S=s("v-icon");return U(),K("div",Ee,[e(S,{icon:h.value,color:V.value,class:"mr-1",small:""},null,8,["icon","color"]),g("span",null,b(y.value)+" "+b(m.value),1)])}}};const we=$=>(Se("data-v-17d6931a"),$=$(),Ce(),$),Fe={class:"mb-4"},Ne={class:"d-flex align-center"},Re={class:"text-h5"},Oe=we(()=>g("h3",{class:"text-subtitle-1 mb-2"},"Free Track Reward",-1)),ze=we(()=>g("h3",{class:"text-subtitle-1 mb-2"},"Inside Track Reward (Premium)",-1)),Be={key:0,class:"text-center pa-4 text-medium-emphasis"},Le={class:"mb-4 text-body-2"},je=we(()=>g("br",null,null,-1)),Ge={__name:"MilestonesTab",setup($){const x=[{title:"Milestone #",key:"milestone_number",sortable:!0,align:"start",width:"10%"},{title:"Required Points",key:"required_points",sortable:!0,width:"15%"},{title:"Free Reward",key:"free_reward",sortable:!1,width:"25%"},{title:"Premium Reward",key:"paid_reward",sortable:!1,width:"25%"},{title:"Actions",key:"actions",sortable:!1,align:"end",width:"15%"}],y=[{title:"Chips",value:"chips"},{title:"Gems",value:"gems"},{title:"Avatar Part",value:"avatar_part"},{title:"Envelope Pack",value:"envelope_pack"},{title:"Holdall Pack",value:"holdall_pack"},{title:"Briefcase Pack",value:"briefcase_pack"}];function m(d){return d==null?void 0:d.includes("_pack")}const h=c([]),V=c([]),p=c(""),f=c(!1),S=c(!1),I=c(!1),k=c(!1),C=c(!1),T=c(""),D=c(!0),H=c(null),w=c({...{milestone_number:0,required_points:0,free_reward_type:"chips",free_reward_amount:0,paid_reward_type:"chips",paid_reward_amount:0,is_active:!0}}),o=c([]),A=W(()=>{const d=h.value.find(l=>l.season_id===p.value);return d?d.name:""});ye(async()=>{await de();const d=localStorage.getItem("selectedSeasonId");d&&(p.value=d,await N(),localStorage.removeItem("selectedSeasonId")),window.addEventListener("change-tab",X)}),Ue(()=>{window.removeEventListener("change-tab",X)});function X(d){if(d.detail==="milestones"){const l=localStorage.getItem("selectedSeasonId");l&&l!==p.value&&(p.value=l,N(),localStorage.removeItem("selectedSeasonId"))}}async function de(){f.value=!0;try{const d=await J.get("/admin/season-pass/seasons");h.value=d.data}catch(d){console.error("Error fetching seasons:",d),alert("Failed to load seasons data")}finally{f.value=!1}}async function N(){if(!p.value){V.value=[];return}f.value=!0;try{const d=await J.get(`/admin/season-pass/seasons/${p.value}/milestones`);V.value=d.data.map(l=>({...l,required_points:Number(l.required_points)||0,free_reward_amount:Number(l.free_reward_amount)||0,paid_reward_amount:Number(l.paid_reward_amount)||0}))}catch(d){console.error("Error fetching milestones:",d),V.value=[],alert("Failed to load milestones data")}finally{f.value=!1}}function ue(d){console.log("editMilestone called with:",JSON.stringify(d)),w.value={...d},Q(()=>{var l;(l=H.value)==null||l.resetValidation(),D.value=!0}),S.value=!0,console.log("editDialog.value set to:",S.value)}async function ce(){const{valid:d}=await H.value.validate();if(!d){console.warn("Single milestone edit form invalid");return}f.value=!0;try{await J.post(`/admin/season-pass/seasons/${p.value}/milestones`,{milestones:[w.value]}),await N(),S.value=!1}catch(l){console.error("Error updating milestone:",l),alert("Failed to update milestone")}finally{f.value=!1}}function se(){if(console.log("Configure Milestones clicked. Current milestones count:",V.value.length),V.value.length>0)o.value=JSON.parse(JSON.stringify(V.value)),console.log("Populating bulk edit with existing milestones.");else{console.log("No existing milestones found. Populating bulk edit with 30 defaults."),o.value=[];for(let l=1;l<=30;l++)o.value.push({milestone_number:l,required_points:l*100,free_reward_type:"chips",free_reward_amount:100+(l-1)*10,paid_reward_type:"chips",paid_reward_amount:250+(l-1)*25,is_active:!0})}o.value.sort((d,l)=>d.milestone_number-l.milestone_number),I.value=!0,console.log("bulkDialog.value set to true. bulkMilestones count:",o.value.length)}function _e(){var l;const d=o.value.length>0?Math.max(0,...o.value.map(E=>E.milestone_number))+1:1;o.value.push({milestone_number:d,required_points:(((l=o.value.at(-1))==null?void 0:l.required_points)||0)+100,free_reward_type:"chips",free_reward_amount:0,paid_reward_type:"chips",paid_reward_amount:0,is_active:!0})}function me(d){confirm(`Are you sure you want to remove Milestone row #${d+1} (Number ${o.value[d].milestone_number})? This row will be deleted on save.`)&&o.value.splice(d,1)}async function ve(){if(!o.value.every(l=>l.required_points>0&&l.milestone_number>0)){alert("Please ensure all milestones have a positive number and required points.");return}f.value=!0;try{const l=o.value;await J.post(`/admin/season-pass/seasons/${p.value}/milestones`,{milestones:l}),await N(),I.value=!1}catch(l){console.error("Error saving bulk milestones:",l),alert("Failed to save milestones")}finally{f.value=!1}}function pe(){T.value="",k.value=!0}async function fe(){var d,l;if(T.value){C.value=!0;try{await J.post("/admin/season-pass/import-sheet",{season_id:p.value,sheet_url:T.value}),await N(),k.value=!1,alert("Milestones imported successfully")}catch(E){console.error("Error importing from sheet:",E),alert(`Failed to import: ${((l=(d=E.response)==null?void 0:d.data)==null?void 0:l.error)||"Unknown error"}`)}finally{C.value=!1}}}return(d,l)=>{const E=s("v-select"),Z=s("v-spacer"),P=s("v-btn"),O=s("v-card-text"),i=s("v-card"),n=s("v-alert"),v=s("v-icon"),z=s("v-tooltip"),q=s("v-data-table"),B=s("v-card-title"),F=s("v-text-field"),_=s("v-col"),L=s("v-checkbox"),R=s("v-row"),Y=s("v-divider"),re=s("v-form"),ae=s("v-card-actions"),le=s("v-dialog"),ge=s("v-card-subtitle"),ee=s("v-container"),j=s("v-chip");return U(),K("div",null,[g("div",Fe,[e(i,{class:"mb-4"},{default:t(()=>[e(O,null,{default:t(()=>[g("div",Ne,[e(E,{modelValue:p.value,"onUpdate:modelValue":[l[0]||(l[0]=a=>p.value=a),N],items:h.value,"item-title":"name","item-value":"season_id",label:"Select Season",variant:"outlined",density:"comfortable",loading:f.value,class:"mr-4","hide-details":""},null,8,["modelValue","items","loading"]),e(Z),e(P,{color:"primary","prepend-icon":"mdi-cogs",onClick:se,disabled:!p.value},{default:t(()=>[r(" Configure Milestones ")]),_:1},8,["disabled"]),e(P,{color:"secondary","prepend-icon":"mdi-table-arrow-down",class:"ml-2",onClick:pe,disabled:!p.value},{default:t(()=>[r(" Import from Sheet ")]),_:1},8,["disabled"])])]),_:1})]),_:1}),p.value?oe("",!0):(U(),te(n,{key:0,type:"info",border:"start",class:"mb-4"},{default:t(()=>[r(" Please select a season to view or configure its milestones. ")]),_:1}))]),p.value?(U(),te(q,{key:0,headers:x,items:V.value,loading:f.value,class:"elevation-1",hover:""},{"item.required_points":t(({item:a})=>{var G;return[r(b((G=a.required_points)==null?void 0:G.toLocaleString())+" AP ",1)]}),"item.free_reward":t(({item:a})=>[e(xe,{type:a.free_reward_type,amount:a.free_reward_amount},null,8,["type","amount"])]),"item.paid_reward":t(({item:a})=>[e(xe,{type:a.paid_reward_type,amount:a.paid_reward_amount},null,8,["type","amount"])]),"item.actions":t(({item:a})=>[e(P,{icon:"",variant:"text",color:"primary",size:"small",onClick:G=>ue(a)},{default:t(()=>[e(v,null,{default:t(()=>[r("mdi-pencil")]),_:1}),e(z,{activator:"parent",location:"top"},{default:t(()=>[r("Edit Milestone "+b(a.milestone_number),1)]),_:2},1024)]),_:2},1032,["onClick"])]),"no-data":t(()=>[r(' No milestones found for this season. Use "Configure Milestones" or "Import from Sheet" to add some. ')]),_:1},8,["items","loading"])):oe("",!0),e(le,{modelValue:S.value,"onUpdate:modelValue":l[9]||(l[9]=a=>S.value=a),"max-width":"700px",persistent:""},{default:t(()=>[e(i,null,{default:t(()=>[e(B,null,{default:t(()=>[g("span",Re,"Edit Milestone "+b(w.value.milestone_number),1)]),_:1}),e(O,null,{default:t(()=>[e(re,{ref_key:"editForm",ref:H,modelValue:D.value,"onUpdate:modelValue":l[7]||(l[7]=a=>D.value=a)},{default:t(()=>[e(R,null,{default:t(()=>[e(_,{cols:"12",sm:"6"},{default:t(()=>[e(F,{modelValue:w.value.required_points,"onUpdate:modelValue":l[1]||(l[1]=a=>w.value.required_points=a),modelModifiers:{number:!0},label:"Required Action Points",type:"number",min:"1",required:"",rules:[a=>a!=null||"Points are required",a=>a>0||"Points must be positive"],variant:"outlined",density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(_,{cols:"12",sm:"6"},{default:t(()=>[e(L,{modelValue:w.value.is_active,"onUpdate:modelValue":l[2]||(l[2]=a=>w.value.is_active=a),label:"Active",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),e(Y,{class:"my-4"}),Oe,e(R,null,{default:t(()=>[e(_,{cols:"12",sm:"6"},{default:t(()=>[e(E,{modelValue:w.value.free_reward_type,"onUpdate:modelValue":l[3]||(l[3]=a=>w.value.free_reward_type=a),label:"Reward Type",items:y,required:"",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6"},{default:t(()=>[e(F,{modelValue:w.value.free_reward_amount,"onUpdate:modelValue":l[4]||(l[4]=a=>w.value.free_reward_amount=a),modelModifiers:{number:!0},label:m(w.value.free_reward_type)?"Pack Info (Optional)":"Reward Amount",type:"number",min:"0",required:"",hint:m(w.value.free_reward_type)?"Usually 0 or 1 for packs":"",rules:[a=>a!=null||"Amount is required",a=>a>=0||"Amount must be non-negative"],variant:"outlined",density:"compact"},null,8,["modelValue","label","hint","rules"])]),_:1})]),_:1}),e(Y,{class:"my-4"}),ze,e(R,null,{default:t(()=>[e(_,{cols:"12",sm:"6"},{default:t(()=>[e(E,{modelValue:w.value.paid_reward_type,"onUpdate:modelValue":l[5]||(l[5]=a=>w.value.paid_reward_type=a),label:"Reward Type",items:y,required:"",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(_,{cols:"12",sm:"6"},{default:t(()=>[e(F,{modelValue:w.value.paid_reward_amount,"onUpdate:modelValue":l[6]||(l[6]=a=>w.value.paid_reward_amount=a),modelModifiers:{number:!0},label:m(w.value.paid_reward_type)?"Pack Info (Optional)":"Reward Amount",type:"number",min:"0",required:"",hint:m(w.value.paid_reward_type)?"Usually 0 or 1 for packs":"",rules:[a=>a!=null||"Amount is required",a=>a>=0||"Amount must be non-negative"],variant:"outlined",density:"compact"},null,8,["modelValue","label","hint","rules"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ae,null,{default:t(()=>[e(Z),e(P,{color:"grey-darken-1",variant:"text",onClick:l[8]||(l[8]=a=>S.value=!1)},{default:t(()=>[r("Cancel")]),_:1}),e(P,{color:"blue-darken-1",variant:"elevated",onClick:ce,disabled:!D.value},{default:t(()=>[r("Save Changes")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(le,{modelValue:I.value,"onUpdate:modelValue":l[11]||(l[11]=a=>I.value=a),"max-width":"95vw",persistent:"",scrollable:""},{default:t(()=>[e(i,null,{default:t(()=>[e(B,{class:"text-h5"},{default:t(()=>[r('Configure Milestones for "'+b(A.value)+'"',1)]),_:1}),e(ge,null,{default:t(()=>[r("Define or adjust all milestones for this season.")]),_:1}),e(O,{style:{"max-height":"75vh"}},{default:t(()=>[e(ee,{fluid:"",class:"pa-0"},{default:t(()=>[o.value.length===0?(U(),K("div",Be," No milestones defined yet. Defaults generated below. Adjust as needed or use Import. ")):oe("",!0),(U(!0),K(De,null,Me(o.value,(a,G)=>(U(),K("div",{key:a.milestone_number||`new-${G}`,class:"milestone-row pa-2 mb-2 elevation-1"},[e(R,{dense:"",align:"center"},{default:t(()=>[e(_,{cols:"auto",class:"font-weight-bold pl-1",style:{"min-width":"50px"}},{default:t(()=>[r(" #"+b(a.milestone_number),1)]),_:2},1024),e(_,null,{default:t(()=>[e(F,{modelValue:a.required_points,"onUpdate:modelValue":M=>a.required_points=M,modelModifiers:{number:!0},label:"Points",type:"number",min:"1",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(_,null,{default:t(()=>[e(E,{modelValue:a.free_reward_type,"onUpdate:modelValue":M=>a.free_reward_type=M,label:"Free Type",items:y,density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(_,{cols:"2"},{default:t(()=>[e(F,{modelValue:a.free_reward_amount,"onUpdate:modelValue":M=>a.free_reward_amount=M,modelModifiers:{number:!0},label:m(a.free_reward_type)?"Pack Info":"Free Amt",type:"number",min:"0",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),e(_,null,{default:t(()=>[e(E,{modelValue:a.paid_reward_type,"onUpdate:modelValue":M=>a.paid_reward_type=M,label:"Premium Type",items:y,density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(_,{cols:"2"},{default:t(()=>[e(F,{modelValue:a.paid_reward_amount,"onUpdate:modelValue":M=>a.paid_reward_amount=M,modelModifiers:{number:!0},label:m(a.paid_reward_type)?"Pack Info":"Premium Amt",type:"number",min:"0",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),e(_,{cols:"auto"},{default:t(()=>[e(L,{modelValue:a.is_active,"onUpdate:modelValue":M=>a.is_active=M,density:"compact","hide-details":"",title:"Active"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(_,{cols:"auto"},{default:t(()=>[e(P,{icon:"mdi-delete-outline",variant:"text",color:"error",size:"small",onClick:M=>me(G),title:"Remove Milestone"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),e(R,{class:"mt-2"},{default:t(()=>[e(_,null,{default:t(()=>[e(P,{"prepend-icon":"mdi-plus-box",onClick:_e,color:"grey-darken-1",variant:"text"},{default:t(()=>[r("Add Milestone Row")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Y),e(ae,null,{default:t(()=>[e(Z),e(P,{color:"grey-darken-1",variant:"text",onClick:l[10]||(l[10]=a=>I.value=!1)},{default:t(()=>[r("Cancel")]),_:1}),e(P,{color:"primary",variant:"elevated",onClick:ve,loading:f.value},{default:t(()=>[r("Save Configuration")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(le,{modelValue:k.value,"onUpdate:modelValue":l[14]||(l[14]=a=>k.value=a),"max-width":"600px",persistent:""},{default:t(()=>[e(i,null,{default:t(()=>[e(B,{class:"text-h5"},{default:t(()=>[r("Import Milestones from Google Sheet")]),_:1}),e(O,null,{default:t(()=>[g("p",Le,[r(" Import milestones data from a Google Sheet. The sheet must be publicly accessible or published to the web and have these columns starting from row 10: "),je,e(j,{size:"x-small",class:"mr-1"},{default:t(()=>[r("Milestone # (Optional)")]),_:1}),e(j,{size:"x-small",class:"mr-1"},{default:t(()=>[r("Points")]),_:1}),e(j,{size:"x-small",class:"mr-1"},{default:t(()=>[r("Free Type")]),_:1}),e(j,{size:"x-small",class:"mr-1"},{default:t(()=>[r("Free Amount/ID")]),_:1}),e(j,{size:"x-small",class:"mr-1"},{default:t(()=>[r("Premium Type")]),_:1}),e(j,{size:"x-small",class:"mr-1"},{default:t(()=>[r("Premium Amount/ID")]),_:1})]),e(F,{modelValue:T.value,"onUpdate:modelValue":l[12]||(l[12]=a=>T.value=a),label:"Google Sheet URL",placeholder:"https://docs.google.com/spreadsheets/d/...",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(ae,null,{default:t(()=>[e(Z),e(P,{color:"grey-darken-1",variant:"text",onClick:l[13]||(l[13]=a=>k.value=!1)},{default:t(()=>[r("Cancel")]),_:1}),e(P,{color:"primary",variant:"elevated",onClick:fe,loading:C.value,disabled:!T.value},{default:t(()=>[r(" Import ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Je=Ve(Ge,[["__scopeId","data-v-17d6931a"]]),Ke={class:"mb-4"},He={class:"d-flex align-center"},Ye={class:"text-h4 font-weight-bold text-primary"},Qe=g("div",{class:"text-subtitle-1 text-grey-darken-1"}," Active Users ",-1),We={class:"text-caption text-grey"},Xe={class:"text-h4 font-weight-bold text-primary"},Ze=g("div",{class:"text-subtitle-1 text-grey-darken-1"}," Inside Track Users ",-1),et={class:"text-caption text-grey"},tt={class:"text-h4 font-weight-bold text-primary"},at=g("div",{class:"text-subtitle-1 text-grey-darken-1"}," Avg. Milestones Completed ",-1),lt={class:"text-h4 font-weight-bold text-primary"},ot=g("div",{class:"text-subtitle-1 text-grey-darken-1"}," Milestones Reached ",-1),nt=g("div",{class:"text-caption text-grey"}," By at least one user ",-1),st={__name:"AnalyticsTab",setup($){const x=c([]),y=c(""),m=c(null),h=c(!1);ye(async()=>{await V()});async function V(){h.value=!0;try{const f=await ke.get("/api/admin/season-pass/seasons");x.value=f.data}catch(f){console.error("Error fetching seasons:",f),alert("Failed to load seasons data")}finally{h.value=!1}}async function p(){if(y.value){h.value=!0,m.value=null;try{const f=await ke.get(`/api/admin/season-pass/seasons/${y.value}/analytics`);m.value=f.data}catch(f){console.error("Error fetching analytics:",f),alert("Failed to load analytics data")}finally{h.value=!1}}}return(f,S)=>{const I=s("v-select"),k=s("v-card-text"),C=s("v-card"),T=s("v-alert"),D=s("v-col"),H=s("v-card-title"),ne=s("v-progress-linear"),w=s("v-row"),o=s("v-skeleton-loader");return U(),K("div",null,[g("div",Ke,[e(C,{class:"mb-4"},{default:t(()=>[e(k,null,{default:t(()=>[g("div",He,[e(I,{modelValue:y.value,"onUpdate:modelValue":[S[0]||(S[0]=A=>y.value=A),p],items:x.value,"item-title":"name","item-value":"season_id",label:"Select Season",variant:"outlined",density:"comfortable",loading:h.value},null,8,["modelValue","items","loading"])])]),_:1})]),_:1}),y.value?oe("",!0):(U(),te(T,{key:0,type:"info",border:"start",class:"mb-4"},{default:t(()=>[r(" Please select a season to view analytics ")]),_:1}))]),m.value&&y.value?(U(),te(w,{key:0},{default:t(()=>[e(D,{cols:"12",md:"3"},{default:t(()=>[e(C,{class:"rounded-lg"},{default:t(()=>[e(k,{class:"text-center"},{default:t(()=>[g("div",Ye,b(m.value.users_with_progress),1),Qe,g("div",We," Of "+b(m.value.total_users)+" total users ",1)]),_:1})]),_:1})]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(C,{class:"rounded-lg"},{default:t(()=>[e(k,{class:"text-center"},{default:t(()=>[g("div",Xe,b(m.value.users_with_inside_track),1),Ze,g("div",et,b((m.value.conversion_rate||0).toFixed(1))+"% conversion rate ",1)]),_:1})]),_:1})]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(C,{class:"rounded-lg"},{default:t(()=>[e(k,{class:"text-center"},{default:t(()=>[g("div",tt,b((m.value.avg_milestones_completed||0).toFixed(1)),1),at]),_:1})]),_:1})]),_:1}),e(D,{cols:"12",md:"3"},{default:t(()=>[e(C,{class:"rounded-lg"},{default:t(()=>[e(k,{class:"text-center"},{default:t(()=>{var A;return[g("div",lt,b(((A=m.value.milestone_completion)==null?void 0:A.length)||0),1),ot,nt]}),_:1})]),_:1})]),_:1}),e(D,{cols:"12"},{default:t(()=>[e(C,null,{default:t(()=>[e(H,null,{default:t(()=>[r("Milestone Completion")]),_:1}),e(k,null,{default:t(()=>[(U(!0),K(De,null,Me(m.value.milestone_completion,A=>(U(),te(ne,{key:A.milestone,"model-value":A.count/m.value.users_with_progress*100,color:"primary",height:"25",rounded:"",class:"mb-3"},{default:t(({value:X})=>[g("strong",null,"Milestone "+b(A.milestone)+": "+b(A.count)+" users ("+b(X.toFixed(1))+"%)",1)]),_:2},1032,["model-value"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})):h.value&&y.value?(U(),te(o,{key:1,type:"card, card-heading, article, card-heading, table"})):oe("",!0)])}}},rt=g("h1",{class:"text-h4 mb-6"},"Season Pass Management",-1),dt={__name:"Index",setup($){const x=c("seasons");return(y,m)=>{const h=s("v-tab"),V=s("v-tabs"),p=s("v-window-item"),f=s("v-window");return U(),K("div",null,[rt,e(V,{modelValue:x.value,"onUpdate:modelValue":m[0]||(m[0]=S=>x.value=S),"bg-color":"primary"},{default:t(()=>[e(h,{value:"seasons"},{default:t(()=>[r("Seasons")]),_:1}),e(h,{value:"milestones"},{default:t(()=>[r("Milestones")]),_:1}),e(h,{value:"analytics"},{default:t(()=>[r("Analytics")]),_:1})]),_:1},8,["modelValue"]),e(f,{modelValue:x.value,"onUpdate:modelValue":m[1]||(m[1]=S=>x.value=S),class:"mt-4"},{default:t(()=>[e(p,{value:"seasons"},{default:t(()=>[e(qe)]),_:1}),e(p,{value:"milestones"},{default:t(()=>[e(Je)]),_:1}),e(p,{value:"analytics"},{default:t(()=>[e(st)]),_:1})]),_:1},8,["modelValue"])])}}};export{dt as default};
